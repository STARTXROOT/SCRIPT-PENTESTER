#!/usr/bin/env python3

import nmap
import os
import subprocess
from datetime import datetime

# -----------------------------------------------
# SCRIPT: StartXroot DeepScan - Exploración Exhaustiva con Nmap y Nikto
# Autor: STARTXROOT
# Redes Sociales: 
#   Facebook: facebook.com/startxr00t
# -----------------------------------------------

# Función para realizar escaneo con Nmap
def nmap_scan(target):
    nm = nmap.PortScanner()
    print(f"Iniciando escaneo Nmap en {target}...")
    nm.scan(hosts=target, arguments='-p 1-65535 -sS -sV -O -Pn')
    hosts_list = [(x, nm[x]['tcp']) for x in nm.all_hosts() if 'tcp' in nm[x]]

    for host, ports in hosts_list:
        print(f"\n[+] Host: {host}")
        print(f"[+] Sistema Operativo: {nm[host]['osmatch'][0]['name']}")
        for port in ports:
            print(f"    Puerto: {port} ({ports[port]['name']}) - {ports[port]['state']}")

    return hosts_list

# Función para realizar escaneo con Nikto
def nikto_scan(host):
    print(f"\nIniciando escaneo Nikto en {host}...")
    nikto_command = f"nikto -h {host} -C all"
    process = subprocess.Popen(nikto_command.split(), stdout=subprocess.PIPE)
    output, error = process.communicate()

    if error:
        print(f"Error en el escaneo Nikto: {error}")
    else:
        print(output.decode())

# Función principal
def main():
    target = input("Ingresa la IP o rango de IPs objetivo: ")

    # Registrar inicio del escaneo
    start_time = datetime.now()
    print(f"Escaneo iniciado a las {start_time}")

    # Realizar escaneo con Nmap
    hosts_and_ports = nmap_scan(target)

    # Realizar escaneo con Nikto en los hosts identificados
    for host, ports in hosts_and_ports:
        if any(port == 80 or port == 443 for port in ports):
            nikto_scan(host)

    # Registrar fin del escaneo
    end_time = datetime.now()
    print(f"\nEscaneo completado a las {end_time}")
    print(f"Duración total: {end_time - start_time}")

if __name__ == "__main__":
    main()
